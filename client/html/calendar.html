<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Schedule Sync</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=yes"
    />
    <meta
      name="google-site-verification"
      content="iTbJ-p6IVlnmn8YXUm689TcZ19mK1nzdVxHm08gF8Yw"
    />
    <link rel="icon" href="assets/images/logo-blue.png" type="image/png" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.css"
    />
    <link rel="stylesheet" type="text/css" href="/css/calendar.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.4.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.4.0/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/rrule@2.6.4/dist/es5/rrule.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.5.0/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/rrule@5.5.0/main.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        var calendar_events = [];
        const response = await fetch("/google-calendar", {
          method: "GET",
          headers: {
            "Content-Type": "application/json;charset=utf-8",
          },
        })
          .then((response) => response.text())
          .then((result) => {
            const events = JSON.parse(result)["calendars"];
            events.forEach((item) => {
              var event = {
                title: item.summary,
                start: item.start.date || item.start.dateTime,
                allDay: item.start.date ? true : false,
                rrule: item.recurrence
                  ? `DTSTART:${new Date(item.start.date || item.start.dateTime)
                      .toISOString()
                      .replace(/-|:/g, "")
                      .replace(/\.\d{3}Z/, "Z")}\n${item.recurrence[0]}`
                  : "",
                url: item.htmlLink,
              };
              calendar_events.push(event);
            });
            console.log(calendar_events[0]);
          });
        var calendarEl = document.getElementById("calendar");

        var calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: "dayGridMonth",
          dayMaxEvents: true,
          headerToolbar: {
            left: "prev,next today",
            center: "title",
            right: "dayGridMonth,timeGridWeek,timeGridDay",
          },
          events: calendar_events,
          eventClick: function (info) {
            info.jsEvent.preventDefault(); // don't let the browser navigate

            if (info.event.url) {
              window.open(info.event.url);
            }
          },
        });
        calendar.render();
      });
    </script>
  </head>

  <body>
    <div class="navbar">
      <a href="./calendar" id="myCalendar">My Calendar</a>
      <a href="./scheduling" id="scheduleMeeting">Schedule a Meeting</a>
      <img
        width="100px"
        height="74x"
        class="logo"
        src="../assets/images/logo-blue.png"
      />
      <a href="./meetings" id="myMeetings">My Meetings</a>
      <a href="./logout" id="logout">Logout</a>
    </div>

    <div id="calendar"></div>

    <div class="footer">
      <style>
        .heart {
          color: #e25555;
        }
      </style>
      <p>Made with <span class="heart">â™¥</span> in Amherst, MA</p>
    </div>
  </body>
</html>
